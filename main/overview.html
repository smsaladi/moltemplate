
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>5. Overview &#8212; moltemplate 2.1 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="6. Object composition and coordinate generation" href="coordinates.html" />
    <link rel="prev" title="4. Introductory tutorial" href="tutorial.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="overview">
<span id="sec-overview"></span><h1><span class="section-number">5. </span>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h1>
<div class="section" id="basics-the-write-and-write-once-commands">
<span id="sec-write"></span><h2><span class="section-number">5.1. </span>Basics: The <em>write()</em> and <em>write_once()</em> commands<a class="headerlink" href="#basics-the-write-and-write-once-commands" title="Permalink to this headline">¶</a></h2>
<p>Each LT file typically contains one or more “write” or “write_once”
commands. These commands have the following syntax</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">write_once</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="p">{</span><span class="n">text_block</span><span class="p">}</span>
</pre></div>
</div>
<p>This creates a new file with the desired file name and fills it with the
text enclosed in curly brackets {}. Text blocks usually span multiple
lines and contain counter variables (beginning with “&#64;” or “$”). which
are replaced with numbers. However the “write()” command will repeatedly
append the same block of text to the file every time the molecule (in
which the write command appears) is generated or copied (using the “new”
command, after incrementing the appropriate counters, as explained in
<a class="reference external" href="#sec:instance_variables">5.2.2</a>).</p>
</div>
<div class="section" id="basics-counter-variables">
<span id="sec-variables"></span><h2><span class="section-number">5.2. </span>Basics: counter variables<a class="headerlink" href="#basics-counter-variables" title="Permalink to this headline">¶</a></h2>
<p>Words following a “&#64;” or a “$” character are <em>counter variables</em>. (These
are not to be confused with <em>LAMMPS variables</em>
<a class="reference external" href="http://lammps.sandia.gov/doc/variable.html">http://lammps.sandia.gov/doc/variable.html</a>). By default, <em>all counter
variables are substituted with a numeric counter</em> before they are
written to a file. These counters begin at 1 (by default), and are
incremented as the system size and complexity grows (see below).</p>
<p>These words typically contain a colon (:) followed by more text. The
text preceding this colon is the <em>category name</em>. (For example:
“$atom:”, “$bond:”, “$angle:”, “&#64;atom:”, “&#64;bond:”, “&#64;angle:”) Variables
belonging to different categories are counted independently.</p>
<p>Users can override these assignment rules and create custom categories.
(See appendices <a class="reference internal" href="../appendix/ttree_man_page.html#sec-manual-assignment"><span class="std std-ref">Manual variables assignment (“-a” or “-b”)</span></a> and
<a class="reference external" href="#sec:custom_categories">14.2</a> for details.)</p>
<div class="section" id="static-counters-begin-with">
<span id="sec-static-variables"></span><h3><span class="section-number">5.2.1. </span>Static counters begin with “&#64;”<a class="headerlink" href="#static-counters-begin-with" title="Permalink to this headline">¶</a></h3>
<p>“&#64;” variables generally correspond to <em>types</em>: such as atom types, bond
types, angle types, dihedral types, improper types. These are simple
variables and they assigned to unique integers in the order they are
read from your LT files. Each uniquely named variable in each category
is assigned to a different integer. For example, “&#64;bond:” type variables
are numbered from “1” to the number of <em>bond types</em>. (Pairs of bonded
atoms are assigned a <em>bond type</em>. Later, LAMMPS will use this integer to
lookup the bond-length and Hooke’s-law elastic constant describing the
force between these two atoms.)</p>
</div>
<div class="section" id="instance-counters-begin-with">
<span id="sec-instance-variables"></span><h3><span class="section-number">5.2.2. </span>Instance counters begin with “$”<a class="headerlink" href="#instance-counters-begin-with" title="Permalink to this headline">¶</a></h3>
<p>On the other hand, “$” variables correspond to unique ID numbers:
atom-IDs, bond-IDs, angle-IDs, dihedral-IDs, improper-IDs, and
molecule-IDs. These variables are created whenever a copy of a molecule
is created (using the “new” command). If you create 1000 copies of a
water molecule using a command like</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">wat</span> <span class="o">=</span> <span class="n">new</span> <span class="n">SPCE</span><span class="p">[</span><span class="mi">10</span><span class="p">][</span><span class="mi">10</span><span class="p">][</span><span class="mi">10</span><span class="p">]</span>
</pre></div>
</div>
<p>then moltemplate creates 3000 “$atom” variables with names like</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$atom:wat[0][0][0]/o
$atom:wat[0][0][0]/h1
$atom:wat[0][0][0]/h2
$atom:wat[0][0][1]/o
$atom:wat[0][0][1]/h1
$atom:wat[0][0][1]/h2
</pre></div>
</div>
<p><span class="math notranslate nohighlight">\(\quad \vdots\)</span></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$atom:wat[9][9][9]/o
$atom:wat[9][9][9]/h1
$atom:wat[9][9][9]/h2
</pre></div>
</div>
</div>
<div class="section" id="variable-names-short-names-vs-full-names">
<span id="sec-full-names"></span><h3><span class="section-number">5.2.3. </span>Variable names: short-names <em>vs.</em> full-names<a class="headerlink" href="#variable-names-short-names-vs-full-names" title="Permalink to this headline">¶</a></h3>
<p>In the example above, the $ variables have full-names like
“$atom:wat[8][3][7]/h1”, not “$atom:h1”. However inside the definition
of the water molecule, you don’t specify the full name. You can refer to
this atom as “$atom:h1”. Likewise, the full-name for the &#64;atom variables
is actually “&#64;atom:SPCE/H”, not “&#64;atom:H”. However inside the definition
of the water molecule, you typically use the shorthand notation
“&#64;atom:H”.</p>
</div>
<div class="section" id="numeric-substitution">
<h3><span class="section-number">5.2.4. </span>Numeric substitution<a class="headerlink" href="#numeric-substitution" title="Permalink to this headline">¶</a></h3>
<p>Before being written to a file, every variable (either $ or &#64;) with a
unique <em>full-name</em> will be assigned to a unique integer, starting at 1
by default.</p>
<p>The various $atom variables in the water example will be substituted
with integers from 1 to 3000 (assuming no other molecules are present).
But the “&#64;atom:O” and “&#64;atom:H” variables (which are shorthand for
“&#64;atom:SPCE/O” and “&#64;atom:SPCE/H”) will be assigned to to “1” and “2”
(again, assuming no other molecule types are present).</p>
<p>So, in summary, &#64; variables increase with the <em>complexity</em> of your
system (IE the number of molecule types or force-field parameters), but
$ variables increase with the <em>size</em> of your system.</p>
</div>
<div class="section" id="variable-scope">
<span id="sec-variable-scope"></span><h3><span class="section-number">5.2.5. </span>Variable scope<a class="headerlink" href="#variable-scope" title="Permalink to this headline">¶</a></h3>
<p>This effectively means that all variables are specific to local
molecules they were defined in. In other words, an atom type named
“&#64;atom:H” inside the “SPCE” molecule, will be assigned to a different
number than an atom named “&#64;atom:H” in an “Arginine” molecule. This is
because the two variables will have different <em>full</em> names
(“&#64;atom:SPCE/H”, and “&#64;atom:Arginine/H”).</p>
</div>
<div class="section" id="sharing-atom-types-or-other-variables-between-molecules">
<h3><span class="section-number">5.2.6. </span>Sharing atom types or other variables between molecules<a class="headerlink" href="#sharing-atom-types-or-other-variables-between-molecules" title="Permalink to this headline">¶</a></h3>
<p>There are several ways to share atom types between two molecules. The
<em>recommended way</em> is to define them in a separate file and refer to them
when needed. This approach is demonstrated in section
<a class="reference internal" href="coordinates.html#sec-2bead"><span class="std std-ref">Building a large molecule from smaller pieces</span></a>.</p>
<p><em>(Alternately, you can define them outside the current molecule
definition, and use file-system-path-like syntax (“../”, or “../../” or
“/”) to access atoms (or molecules) outside of the current molecule. For
example, two different molecule types can share the same type of
hydrogen atom by referring to it using this syntax: “&#64;atom:../H”. For
details, see section</em><a class="reference external" href="#sec:paths">9.6</a><em>. and
appendix</em><a class="reference external" href="#sec:adv_variable_syntax">17</a><em>.)</em></p>
</div>
</div>
<div class="section" id="troubleshooting-using-the-output-ttree-directory">
<span id="sec-output-ttree"></span><h2><span class="section-number">5.3. </span>Troubleshooting using the <em>output_ttree</em> directory<a class="headerlink" href="#troubleshooting-using-the-output-ttree-directory" title="Permalink to this headline">¶</a></h2>
<p>Users can see what numbers were assigned to each variable by inspecting
the contents of the “output_ttree” subdirectory created by moltemplate.
Unfortunately, it not unusual for LAMMPS to crash the first time you
attempt to run it on a DATA file created by moltemplate. This often
occurs if you failed to spell atom types and other variables
consistently. The LAMMPS error message (located at the end of the
“log.lammps” file created by LAMMPS) will help you determine what type
of mistake you made. (For example, what type of variable was misspelled
or placed in the wrong place?)</p>
<p>To help you, the “output_ttree” directory contains a file named
“ttree_assignments.txt”. This is a simple 2-column text file containing
a list of <em>all</em> of the variables you have created in one column, and the
numbers they were assigned to in the second column. (There is also a
comment on each line beginning with a “#” character which indicates the
file and line number where this variable is first used.)</p>
<p>The “output_ttree” directory also contains all of the files that you
created. The versions with a “.template” extension contain text
interspersed with <em>full</em> variable names (before numeric substitution).
(A spelling mistake, like using “$atom:h” when you meant to say
“$atom:h1” or “&#64;atom:H” will show up in these files if you inspect them
carefully.) This can help you identify where the mistake occurred in
your LT files.</p>
<p>Once a molecular system is debugged and working, users can ignore or
discard the contents of this directory.</p>
</div>
<div class="section" id="data-and-in">
<span id="sec-datain"></span><h2><span class="section-number">5.4. </span>“Data” and “In”<a class="headerlink" href="#data-and-in" title="Permalink to this headline">¶</a></h2>
<p>Again, LAMMPS requires an <em>input script</em> and a <em>data file</em> to run.
<em>Moltemplate’s job is to generate these files.</em> <em>Input scripts</em>
typically contain force-field styles, parameters and run settings <em>Data
files</em> typically contain atom coordinates and bonded topology data.</p>
<p>If you are familiar with LAMMPS, you may have noticed the file names
above (in the example from section <a class="reference internal" href="tutorial.html#sec-spce-example"><span class="std std-ref">Simulating a box of water using moltemplate and LAMMPS</span></a>) sound
suspiciously like sections from LAMMPS data files or input scripts, such
as “Data Boundary”, “Data Atoms”, “Data Bonds”, “Data Masses”, “Data
Angles”, “Data Dihedrals”, “Data Impropers”, “In Init”, “In Settings”).
All files whose names begin with “In” or “Data” are special. For the
user’s convenience, the moltemplate.sh script copies the contents of
these files into the corresponding section (“Atoms”, “Bonds”, “Angles”,
etc.) of the DATA file or INPUT scripts generated by moltemplate
(“system.data”, “system.in.settings”, etc). (Then the original files are
moved to the “output_ttree/” directory, in an effort to clean things up
and hide them from view.) Users can create their own custom sections to
a LAMMPS data file. (See section <a class="reference external" href="#sec:custom_data">5.6</a>.</p>
<p>More generally, the “write()” and “write_once()” commands can be used to
create any other files you may need to run your simulations, which refer
to the same <em>&#64;atom</em> and <em>&#64;bond</em> types. (See section
<a class="reference external" href="#sec:aux_files">5.5</a> for an example.)</p>
</div>
<div class="section" id="advanced-using-moltemplate-to-generate-auxiliary-files">
<span id="sec-aux-files"></span><h2><span class="section-number">5.5. </span><em>(Advanced)</em> Using moltemplate to generate auxiliary files<a class="headerlink" href="#advanced-using-moltemplate-to-generate-auxiliary-files" title="Permalink to this headline">¶</a></h2>
<p>The following excerpt from an LT file creates a file named
“system.in.sw”. (It contains parameters for the “sw” pair style. This
exotic many-body pair style requires a large number of parameters, which
are read from a separate file.) This “system.in.sw” file file will be
read later when you run the simulation. (The pair_coeff command below
tells LAMPS to read that file.)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">write_once</span><span class="p">(</span><span class="s2">&quot;system.in.sw&quot;</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">mW</span> <span class="n">mW</span> <span class="n">mW</span> <span class="mf">6.189</span> <span class="mf">2.3925</span> <span class="mf">1.8</span> <span class="mf">23.15</span> <span class="mf">1.2</span> <span class="o">-</span><span class="mf">0.33333</span> <span class="mf">7.04956</span> <span class="mf">0.602224</span> <span class="mi">4</span> <span class="mi">0</span> <span class="mi">0</span>
<span class="p">}</span>
<span class="n">write_once</span><span class="p">(</span><span class="s2">&quot;In Settings&quot;</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">pair_coeff</span> <span class="o">*</span> <span class="o">*</span> <span class="n">sw</span> <span class="n">system</span><span class="o">.</span><span class="ow">in</span><span class="o">.</span><span class="n">sw</span> <span class="n">mW</span> <span class="n">NULL</span> <span class="n">NULL</span> <span class="n">NULL</span>
<span class="p">}</span>
</pre></div>
</div>
<p>As new force-field styles and/or fixes are added to LAMMPS, the files
they depend on can be embedded in an LT file in this way.</p>
</div>
<div class="section" id="advanced-making-custom-data-sections">
<span id="sec-custom-data"></span><h2><span class="section-number">5.6. </span><em>(Advanced)</em> Making custom DATA sections<a class="headerlink" href="#advanced-making-custom-data-sections" title="Permalink to this headline">¶</a></h2>
<p>Suppose that in the future, the format of the LAMMPS DATA file changes
so that it now becomes necessary to supply a new section named “Foo Fee
Fum”, for example. You could do that using this command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">write_once</span><span class="p">(</span><span class="s2">&quot;Data Foo Fee Fum&quot;</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">File</span> <span class="n">contents</span> <span class="n">goes</span> <span class="n">here</span><span class="o">.</span> <span class="p">(</span><span class="n">These</span> <span class="n">files</span> <span class="n">can</span> <span class="n">contain</span>
  <span class="n">atom</span> <span class="n">counters</span> <span class="ow">and</span><span class="o">/</span><span class="ow">or</span> <span class="n">other</span> <span class="n">counter</span> <span class="n">variables</span><span class="p">)</span><span class="o">.</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This way moltemplate copy this text into the “Foo Fee Fum” section at
the end of the DATA file it is constructing. This allows users to adapt
to future changes in the LAMMPS data file format.</p>
<div class="section" id="does-atom-h-conflict-with-atom-h">
<span id="sec-vardetails"></span><h3><span class="section-number">5.6.1. </span>Does “&#64;atom:H” conflict with “$atom:H”?<a class="headerlink" href="#does-atom-h-conflict-with-atom-h" title="Permalink to this headline">¶</a></h3>
<p>No. It is okay for static(&#64;) and instance($) variables to share the same
names. (Moltemplate considers them distinct variables and they will be
assigned independently.)</p>
</div>
<div class="section" id="addional-details">
<h3><span class="section-number">5.6.2. </span>Addional Details<a class="headerlink" href="#addional-details" title="Permalink to this headline">¶</a></h3>
<p>Variable and molecule names can include unicode characters. They can
also include some whitespace characters and other special characters by
using backslashes and curly-brackets, for example: “&#64;{atom: CA }” and
“&#64;atom: CA ”. Curly-brackets are useful to clarify when a variable
name begins and ends, such as in this example: “&#64;{atom:C}&#64;{atom:H}”.
This prevents the “*” character from being appended to the end of the
“C” variable name. (Note that using the “*” character in any of the
<em>coeff</em> commands within moltemplate is discouraged. See section
<a class="reference external" href="#sec:wildcard_bug">[sec:wildcard_bug]</a>.)</p>
<p><em>(Unicode is supported.)</em></p>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">moltemplate</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">2. Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="quick_reference.html">3. Quick reference <em>(skip on first reading)</em></a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">4. Introductory tutorial</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">5. Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#basics-the-write-and-write-once-commands">5.1. Basics: The <em>write()</em> and <em>write_once()</em> commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="#basics-counter-variables">5.2. Basics: counter variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="#troubleshooting-using-the-output-ttree-directory">5.3. Troubleshooting using the <em>output_ttree</em> directory</a></li>
<li class="toctree-l2"><a class="reference internal" href="#data-and-in">5.4. “Data” and “In”</a></li>
<li class="toctree-l2"><a class="reference internal" href="#advanced-using-moltemplate-to-generate-auxiliary-files">5.5. <em>(Advanced)</em> Using moltemplate to generate auxiliary files</a></li>
<li class="toctree-l2"><a class="reference internal" href="#advanced-making-custom-data-sections">5.6. <em>(Advanced)</em> Making custom DATA sections</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="coordinates.html">6. Object composition and coordinate generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="arrays.html">7. Arrays, slices, and coordinate transformations</a></li>
<li class="toctree-l1"><a class="reference internal" href="custom_xform.html">8. Customizing molecule position and topology</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/spce_example_robust.html">9. Portability: Using <em>LT files</em> for force-field storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="limitations.html">10. Known bugs and limitations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/nbody_by_type.html">11. Bonded interactions “By Type”</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/ltemplify.html">12. Using ltemplify.py to create an <em>LT file</em></a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/vmd_advanced.html">13. Visualization in VMD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/ttree_man_page.html">14. Advanced moltemplate.sh Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/ttree.html">15. Using <em>lttree.py</em> or <em>ttree.py</em> directly</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/nbody_by_type_utility.html">16. Using the <em>nbody_by_type.py</em> utility</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/adv_variable_syntax.html">17. Variable syntax details</a></li>
<li class="toctree-l1"><a class="reference internal" href="../utils/dump2data.html">18. dump2data.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../utils/extract_lammps_data.html">19. extract_lammps_data.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../utils/genpoly_lt.html">20. genpoly_lt.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../utils/interpolate_curve.html">21. interpolate_curve.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../utils/ltemplify.html">22. ltemplify.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../utils/raw2data.html">23. raw2data.py</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="tutorial.html" title="previous chapter"><span class="section-number">4. </span>Introductory tutorial</a></li>
      <li>Next: <a href="coordinates.html" title="next chapter"><span class="section-number">6. </span>Object composition and coordinate generation</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Andrew Jewett.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.4.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/main/overview.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>