
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>15. Using lttree.py or ttree.py directly &#8212; moltemplate 2.1 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="16. Using the nbody_by_type.py utility" href="nbody_by_type_utility.html" />
    <link rel="prev" title="14. Advanced moltemplate.sh Usage" href="ttree_man_page.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="using-lttree-py-or-ttree-py-directly">
<span id="sec-ttree"></span><h1><span class="section-number">15. </span>Using <em>lttree.py</em> or <em>ttree.py</em> directly<a class="headerlink" href="#using-lttree-py-or-ttree-py-directly" title="Permalink to this headline">¶</a></h1>
<div class="section" id="bypassing-moltemplate-sh">
<h2><span class="section-number">15.1. </span>(bypassing moltemplate.sh)<a class="headerlink" href="#bypassing-moltemplate-sh" title="Permalink to this headline">¶</a></h2>
<p>“moltemplate.sh” is only a simple script which invokes “lttree.py”, and
then combines the various output files generated by lttree.py into a
single LAMMPS input script and a data file, along with coordinate data.
“lttree.py” then invokes “ttree.py”. “ttree.py” lacks the ability to
read or generate coordinates, but is otherwise nearly identical to
“lttree.py” and “moltemplate.sh”.</p>
<p>If in the future moltemplate.sh no longer works with some new, recently
added LAMMPS feature, you can bypass moltemplate.sh and run lttree.py or
ttree.py directly. Everything moltemplate.sh does can essentially be
done by hand with a unix shell and a text editor. This procedure is
outlined below.</p>
</div>
<div class="section" id="first-run-ttree-py">
<h2><span class="section-number">15.2. </span>First run ttree.py<a class="headerlink" href="#first-run-ttree-py" title="Permalink to this headline">¶</a></h2>
<p>The syntax for running “ttree.py” is identical to the syntax for running
moltemplate.sh. The moltemplate.sh syntax is explained above.</p>
<p>Unfortunately, ttree.py does not understand the -pdb, -xyz, or -raw
arguments for processing coordinate data. If you run “ttree.py”
directly, then you must extract the coordinate data from these files
yourself and insert it into your lammps input files manually. This is
explained below.</p>
<p>Example: Go to the examples/waterSPCE/ directory and run:</p>
<p>ttree.py system.lt</p>
<p>This will prepare LAMMPS input files for a system of 32 water molecules.
(In this example, we are using the “SPCE” water model.)</p>
<p>Running the command above will probably create the following files:
“Data Atoms” (The “Atoms” section of a LAMMPS data file, w/o
coordinates) “Data Bonds” (The “Bonds” section of a LAMMPS data file)
“Data Angles” (The “Angles” section of a LAMMPS data file) “Data Masses”
(The “Masses” section of a LAMMPS data file) “In Init” (The
“Initialization” section of a LAMMPS input script.) “In Settings” (The
“Settings” section of a LAMMPS input script, which typically contains
force-field parameters, group defs, and constraints) “Data Boundary”
(The “Periodic Boundary Conditions” section of a LAMMPS data file.)
“ttree_assignments.txt” (Variable assignments. See “customization”
section.)</p>
<p>This data can be easily combined into a single LAMMPS data file and a
single lammps input script later on, using a text editor, or the unix
“cat” and “paste” commands.</p>
<p>It may also create these files: “Data Angles By Type”, “Data Dihedrals
By Type”, “Data Impropers By Type”. These files tell moltemplate how to
automatically generate bonded-interactions by atom and bond type. They
must be converted to lists of angles, dihedrals, and impropers, using
the “nbody_by_type.py” utility (as explained in appendix
<a class="reference external" href="#sec:nbody_by_type">11</a>).</p>
</div>
<div class="section" id="then-create-a-lammps-data-file">
<h2><span class="section-number">15.3. </span>Then create a LAMMPS data file<a class="headerlink" href="#then-create-a-lammps-data-file" title="Permalink to this headline">¶</a></h2>
<p>Create a new file (“system.data” in this example), and paste the
following text into it:</p>
<div class="section" id="create-the-header-section">
<h3><span class="section-number">15.3.1. </span>Create the “header” section<a class="headerlink" href="#create-the-header-section" title="Permalink to this headline">¶</a></h3>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">LAMMPS</span> <span class="n">Description</span>

     <span class="mi">96</span>  <span class="n">atoms</span>
     <span class="mi">64</span>  <span class="n">bonds</span>
     <span class="mi">32</span>  <span class="n">angles</span>
     <span class="mi">0</span>  <span class="n">dihedrals</span>

     <span class="mi">2</span>  <span class="n">atom</span> <span class="n">types</span>
     <span class="mi">1</span>  <span class="n">bond</span> <span class="n">types</span>
     <span class="mi">1</span>  <span class="n">angle</span> <span class="n">types</span>
     <span class="mi">0</span>  <span class="n">dihedral</span> <span class="n">types</span>

  <span class="mf">0.000000</span>   <span class="mf">9.043</span>    <span class="n">xlo</span> <span class="n">xhi</span>
  <span class="mf">0.000000</span>   <span class="mf">15.663</span>   <span class="n">ylo</span> <span class="n">yhi</span>
  <span class="mf">0.000000</span>   <span class="mf">7.361</span>    <span class="n">zlo</span> <span class="n">zhi</span>
</pre></div>
</div>
<p>If you use ttree.py, will have to count the number of atoms, bonds, and
atom types, bond types etc. yourself.</p>
<p>Note: the numbers in the “xlo xhi” “ylo yhi” “zlo zhi” lines determine
the simulation box size, and will vary from system to system. If ttree
created a file named “Data Boundary”, you can copy this information from
there. (Triclinic cells have a fourth line containing the “xy xz yz”
parameters.) (If you have a .PDB file, these boundary box numbers are in
the “CRYST1” line near the beginning of the file.)</p>
<p>Once you’ve created the “header” section of the data file, paste the
other sections to the end of your LAMMPS data file (with the appropriate
section headings and blank lines).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">echo</span> <span class="s2">&quot;&quot;</span> <span class="o">&gt;&gt;</span> <span class="n">system</span><span class="o">.</span><span class="n">data</span>
<span class="n">echo</span> <span class="s2">&quot;Atoms&quot;</span> <span class="o">&gt;&gt;</span> <span class="n">system</span><span class="o">.</span><span class="n">data</span>
<span class="n">echo</span> <span class="s2">&quot;&quot;</span> <span class="o">&gt;&gt;</span> <span class="n">system</span><span class="o">.</span><span class="n">data</span>
<span class="n">cat</span> <span class="s2">&quot;Data Atoms&quot;</span> <span class="o">&gt;&gt;</span> <span class="n">system</span><span class="o">.</span><span class="n">data</span>
<span class="n">echo</span> <span class="s2">&quot;&quot;</span> <span class="o">&gt;&gt;</span> <span class="n">system</span><span class="o">.</span><span class="n">data</span>
<span class="n">echo</span> <span class="s2">&quot;Bonds&quot;</span> <span class="o">&gt;&gt;</span> <span class="n">system</span><span class="o">.</span><span class="n">data</span>
<span class="n">echo</span> <span class="s2">&quot;&quot;</span> <span class="o">&gt;&gt;</span> <span class="n">system</span><span class="o">.</span><span class="n">data</span>
<span class="n">cat</span> <span class="s2">&quot;Data Bonds&quot;</span> <span class="o">&gt;&gt;</span> <span class="n">system</span><span class="o">.</span><span class="n">data</span>
<span class="n">echo</span> <span class="s2">&quot;&quot;</span> <span class="o">&gt;&gt;</span> <span class="n">system</span><span class="o">.</span><span class="n">data</span>
<span class="n">echo</span> <span class="s2">&quot;Angles&quot;</span> <span class="o">&gt;&gt;</span> <span class="n">system</span><span class="o">.</span><span class="n">data</span>
<span class="n">echo</span> <span class="s2">&quot;&quot;</span> <span class="o">&gt;&gt;</span> <span class="n">system</span><span class="o">.</span><span class="n">data</span>
<span class="n">cat</span> <span class="s2">&quot;Data Angles&quot;</span> <span class="o">&gt;&gt;</span> <span class="n">system</span><span class="o">.</span><span class="n">data</span>
<span class="n">echo</span> <span class="s2">&quot;&quot;</span> <span class="o">&gt;&gt;</span> <span class="n">system</span><span class="o">.</span><span class="n">data</span>
<span class="n">echo</span> <span class="s2">&quot;Masses&quot;</span> <span class="o">&gt;&gt;</span> <span class="n">system</span><span class="o">.</span><span class="n">data</span>
<span class="n">echo</span> <span class="s2">&quot;&quot;</span> <span class="o">&gt;&gt;</span> <span class="n">system</span><span class="o">.</span><span class="n">data</span>
<span class="n">cat</span> <span class="s2">&quot;Data Masses&quot;</span> <span class="o">&gt;&gt;</span> <span class="n">system</span><span class="o">.</span><span class="n">data</span>
<span class="n">echo</span> <span class="s2">&quot;&quot;</span> <span class="o">&gt;&gt;</span> <span class="n">system</span><span class="o">.</span><span class="n">data</span>
</pre></div>
</div>
<p>Depending on your system, you may also have these files as well: “Data
Dihedrals” “Data Impropers” “Data Bond Coeffs” “Data Angle Coeffs” “Data
Dihedral Coeffs” “Data Improper Coeffs”. If so, then then append them to
the end of your data file as well. (There are numerous other optional
sections for “class2” force-fields. Exotic atom styles also require
their own sections such as “lines” “ellipsoids” and “triangles”. Consult
the LAMMPS documentation for details on these as well.)</p>
</div>
</div>
<div class="section" id="now-create-the-lammps-input-script">
<h2><span class="section-number">15.4. </span>Now create the LAMMPS input script<a class="headerlink" href="#now-create-the-lammps-input-script" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">echo</span> <span class="s2">&quot;include </span><span class="se">\&quot;</span><span class="s2">In Init</span><span class="se">\&quot;</span><span class="s2">&quot;</span> <span class="o">&gt;</span> <span class="n">system</span><span class="o">.</span><span class="ow">in</span>
<span class="n">echo</span> <span class="s2">&quot;read_data system.data&quot;</span> <span class="o">&gt;&gt;</span> <span class="n">system</span><span class="o">.</span><span class="ow">in</span>
<span class="n">echo</span> <span class="s2">&quot;include </span><span class="se">\&quot;</span><span class="s2">In Settings</span><span class="se">\&quot;</span><span class="s2">&quot;</span> <span class="o">&gt;&gt;</span> <span class="n">system</span><span class="o">.</span><span class="ow">in</span>
</pre></div>
</div>
<p>Lastly, you have to worry about supplying the atomic coordinates.
(Unlike moltemplate, ttree.py does not handle atom coordinates.)</p>
<p>The following commands are useful for extracting coordinates from PDB or
XYZ files and converting them to LAMMPS input script commands:</p>
</div>
<div class="section" id="extract-coordinates">
<h2><span class="section-number">15.5. </span>Extract coordinates<a class="headerlink" href="#extract-coordinates" title="Permalink to this headline">¶</a></h2>
<p>To extract coordinates from a .PDB file (“file.pdb”), use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">awk</span> <span class="s1">&#39;/^ATOM  |^HETATM/{print substr($0,31,8) </span><span class="se">\</span>
<span class="s1">                          &quot; &quot;substr($0,39,8) </span><span class="se">\</span>
<span class="s1">                          &quot; &quot;substr($0,47,8)}&#39;</span> \
    <span class="o">&lt;</span> <span class="n">file</span><span class="o">.</span><span class="n">pdb</span> \
    <span class="o">&gt;</span> <span class="n">tmp_atom_coords</span><span class="o">.</span><span class="n">dat</span>
</pre></div>
</div>
<p><em>(Note: There should be two spaces following the word “ATOM” above.)</em></p>
<p>To extract coordinates from an XYZ file (“file.xyz”), use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">awk</span> <span class="s1">&#39;function isnum(x){return(x==x+0)} </span><span class="se">\</span>
<span class="s1">     BEGIN{targetframe=1;framecount=0} </span><span class="se">\</span>
<span class="s1">     {if (isnum($0)) {framecount++} else </span><span class="se">\</span>
<span class="s1">      {if (framecount==targetframe) { </span><span class="se">\</span>
<span class="s1">       if (NF&gt;0) { </span><span class="se">\</span>
<span class="s1">        if ((NF==3) &amp;&amp; isnum($1)) { </span><span class="se">\</span>
<span class="s1">         print $1&quot; &quot;$2&quot; &quot;$3} </span><span class="se">\</span>
<span class="s1">        else if ((NF==4) &amp;&amp; isnum($2)) { </span><span class="se">\</span>
<span class="s1">         print $2&quot; &quot;$3&quot; &quot;$4} }}}}&#39;</span> \
    <span class="o">&lt;</span> <span class="n">file</span><span class="o">.</span><span class="n">xyz</span> \
    <span class="o">&gt;</span> <span class="n">tmp_atom_coords</span><span class="o">.</span><span class="n">dat</span>
</pre></div>
</div>
</div>
<div class="section" id="convert-the-coordinate-file-to-lammps-input-script-format">
<h2><span class="section-number">15.6. </span>Convert the coordinate file to LAMMPS input script format<a class="headerlink" href="#convert-the-coordinate-file-to-lammps-input-script-format" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">awk</span> <span class="s1">&#39;{if (NF&gt;=3) { </span><span class="se">\</span>
<span class="s1">      natom++; print &quot;set atom &quot;natom&quot; x &quot;$1&quot; y &quot;$2&quot; z &quot;$3&quot; &quot;}}&#39;</span> \
    <span class="o">&lt;</span> <span class="n">tmp_atom_coords</span><span class="o">.</span><span class="n">dat</span> \
   <span class="o">&gt;&gt;</span> <span class="n">system</span><span class="o">.</span><span class="ow">in</span><span class="o">.</span><span class="n">coords</span>
</pre></div>
</div>
<p>Finally import “system.in.coords” in your lammps input script using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">echo</span> <span class="s2">&quot;include </span><span class="se">\&quot;</span><span class="s2">system.in.coords</span><span class="se">\&quot;</span><span class="s2">&quot;</span> <span class="o">&gt;&gt;</span> <span class="n">system</span><span class="o">.</span><span class="ow">in</span>
</pre></div>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">moltemplate</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../main/installation.html">2. Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../main/quick_reference.html">3. Quick reference <em>(skip on first reading)</em></a></li>
<li class="toctree-l1"><a class="reference internal" href="../main/tutorial.html">4. Introductory tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../main/overview.html">5. Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../main/coordinates.html">6. Object composition and coordinate generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../main/arrays.html">7. Arrays, slices, and coordinate transformations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../main/custom_xform.html">8. Customizing molecule position and topology</a></li>
<li class="toctree-l1"><a class="reference internal" href="spce_example_robust.html">9. Portability: Using <em>LT files</em> for force-field storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../main/limitations.html">10. Known bugs and limitations</a></li>
<li class="toctree-l1"><a class="reference internal" href="nbody_by_type.html">11. Bonded interactions “By Type”</a></li>
<li class="toctree-l1"><a class="reference internal" href="ltemplify.html">12. Using ltemplify.py to create an <em>LT file</em></a></li>
<li class="toctree-l1"><a class="reference internal" href="vmd_advanced.html">13. Visualization in VMD</a></li>
<li class="toctree-l1"><a class="reference internal" href="ttree_man_page.html">14. Advanced moltemplate.sh Usage</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">15. Using <em>lttree.py</em> or <em>ttree.py</em> directly</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#bypassing-moltemplate-sh">15.1. (bypassing moltemplate.sh)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#first-run-ttree-py">15.2. First run ttree.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="#then-create-a-lammps-data-file">15.3. Then create a LAMMPS data file</a></li>
<li class="toctree-l2"><a class="reference internal" href="#now-create-the-lammps-input-script">15.4. Now create the LAMMPS input script</a></li>
<li class="toctree-l2"><a class="reference internal" href="#extract-coordinates">15.5. Extract coordinates</a></li>
<li class="toctree-l2"><a class="reference internal" href="#convert-the-coordinate-file-to-lammps-input-script-format">15.6. Convert the coordinate file to LAMMPS input script format</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="nbody_by_type_utility.html">16. Using the <em>nbody_by_type.py</em> utility</a></li>
<li class="toctree-l1"><a class="reference internal" href="adv_variable_syntax.html">17. Variable syntax details</a></li>
<li class="toctree-l1"><a class="reference internal" href="../utils/dump2data.html">18. dump2data.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../utils/extract_lammps_data.html">19. extract_lammps_data.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../utils/genpoly_lt.html">20. genpoly_lt.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../utils/interpolate_curve.html">21. interpolate_curve.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../utils/ltemplify.html">22. ltemplify.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../utils/raw2data.html">23. raw2data.py</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="ttree_man_page.html" title="previous chapter"><span class="section-number">14. </span>Advanced moltemplate.sh Usage</a></li>
      <li>Next: <a href="nbody_by_type_utility.html" title="next chapter"><span class="section-number">16. </span>Using the <em>nbody_by_type.py</em> utility</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Andrew Jewett.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.4.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/appendix/ttree.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>